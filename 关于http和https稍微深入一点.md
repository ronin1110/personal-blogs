# http和https

## 基本概念：

https的ssl加密是在传输层实现的。

### http

超文本传输协议，是互联网上应用最为广泛的一种网络协议，是一个客户端与服务端的请求和应答的标准（），用于从www服务器传输超文本到本地浏览器的传输协议，可以使浏览器更加高效，网络传输减少。

### https

是以安全网为目的的HTTP通道，简单来说就是http的安全版本，即http下加入SSl层，https的安全基础就是ssl，因此加密的详细内容就需要用到ssl

https协议的主要作用就是：建立一个信息安全通道，来确保数组的传输，确保网站的真实性。

具体



## 区别

http传输的信息是未加密的，也就是明文的，网景公司设置了ssl协议来对http传输的内容进行了加密处理，也就是https是由http和ssl协议构建起的可进行加密传输和身份认证的网络协议，比http的安全性更高。

主要区别：

1. https需要用到ca证书，因为要用到加密手段
2. http是超文本传输协议，信息是明文传输的，https是具有安全性的ssl加密传输协议，
3. http的链接是**无状态的**，无连接的，https是由http和ssl协议构建起的可进行加密传输和身份认证的网络协议，比http的安全性更高。

**http无状态**：不同的请求之间没有记录， http的当年的设计出来适用于单纯的请求html文件，所以无状态是符合当年的理念和需求的，后来随着前端的发展，人们发现前后端的交互越来越频繁，也就是我们需要知道当前请求的网页在之前的状态，类似的就是登录状态的维持，所以我们后面需要各种手段来实现状态的记录，由此出现了cookie和session技术（之后再做相关总结）。





## http

特点：

1. 无状态：协议对客户端没有状态存储，对事物处理没有“记忆”能力，比如访问一个网站需要反复进行登录操作
2. 无连接：http1.1之前，主要体现在客户端请求同一个资源的多次请求之间是没有任何关系的，即每次连接都需要经过TCP/IP三次握手四次挥手（之后总结）
3. 基于请求和响应，客户端发起请求，服务端响应
4. 简单快速，灵活
5. 请求和响应的都是明文，没有对请求进行确认，无法保持数据的完整性



针对http的无状态的解决策略

1. cookie和Session技术
2. http/1.1的持久连接，（HTTp keep-alive）方法，只要任何一方没有明确提出断开连接，则保持TCp的连接状态，可以再请求的首部字段Connection：keep-alive 即表明使用了持久连接，



http各版本的发展

| 版本     | 内容                                                         |
| :------- | :----------------------------------------------------------- |
| HTTP/0.9 | 仅支持GET请求，不支持请求头                                  |
| HTTP/1.0 | 默认短连接（一次请求建议一次TCP连接，请求完就断开 *无状态*），支持GET、POST、 HEAD请求 |
| HTTP/1.1 | 默认长连接（一次TCP连接可以多次请求）；支持PUT、DELETE、PATCH等六种请求,增加host头，支持虚拟主机，支持断点续传 |
| HTTP/2.0 | 多路复用；降低开销（一次TCP连接可以处理多个请求）；<br />服务器主动推送（相关资源一个请求主动推送）<br />解析基于二进制，解析错误少，更高效，（之前的基于文本）<br />报头压缩，降低开销。 |

## https

特点

1. 内容加密：采用混合加密技术（对称加密和非对称加密），中间者无法直接查看明文的内容
2. 验证身份：通过证书认证客户端是访问的自己的服务器
3. 保存数据完整性：防止了数据内容被中间人看到或者篡改



**用到的技术**

- 混合加密：结合了对称加密和非对称加密技术，（下方分析） 
- 数字摘要技术：通过单向hash函数对原文进行哈希，将需加密的明文“摘要”成一串固定长度(如128bit)的密文，不同的明文摘要成的密文其结果总是不相同，同样的明文其摘要必定一致，并且即使知道了摘要也不能反推出明文。
- 数字签名技术：数字签名建立在公钥加密体制基础上，是公钥加密技术的另一类应用。它把公钥加密技术和数字摘要结合起来，形成了实用的数字签名技术。



**下面来说说混合加密模式：**

首先我们有客户端和服务器

1. 客户端https请求服务端，然后就会要求建立ssl连接，
2. 服务器收到客户端的请求，然后会去申请或者自制数字证书，会得到用于非对称加密的公钥和私钥，然后会把公钥以证书的形式传回给客户端，所以现在客户端有了非对称加密的公钥（非对称加密公钥公开是没有问题的），然后服务端有了非对称加密的公钥还有私钥，
3. 客户端接收到公钥，这里客户端会去验证公钥的真实性（验证请求的服务器是否是正确的），如果不通过，就会中断https请求，如果通过，就会在客户端生成一个用于对称加密的**秘钥**（这里我就称之为秘钥），再之后，客户端会对发送的**内容**用客户端自己生成的秘钥加密，再用服务器端给的公钥加密这把客户端生成的秘钥，（就是堆秘钥用公钥加密发给服务器），然后发送给服务器
4. 服务器收到客户端的数据，然后服务器端就会用私钥解密数据就会得到客户端生成的用于对称加密的秘钥，然后用得到的秘钥就能解密出数据的完整内容

**HTTPS怎么校验证书的有效性？**

　　证书里面包含了公钥+各种信息+签名，公钥加密私钥解，私钥加密公钥解，通过私钥将签名解密后得到的信息和证书里面的信息比对就可以验证证书的合法性了。



**验证文件是否被篡改，**

首先，非对称加密的公钥和私钥分别都可以用以加密和解密，公钥加密私钥解，私钥加密公钥解，

然后客户端会通过一个哈希函数,获得一个数字摘要1，然后数字摘要1经过非对称加密的公钥加密，发送到服务器，服务器用私钥解开，得到数字摘要1，然后原文发送到服务器端后，再进行一次哈希函数处理原文得到数字摘要2，比较数字摘要1和2就能判断原文在传送过程中是否被修改过。

![图](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8dbebdbeb83b49e29329e61f69d47e59~tplv-k3u1fbpfcp-zoom-1.image)

## http通讯

![这里写图片描述](https://img-blog.csdn.net/20180719094756330?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpYW9taW5nMTAwMDAx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

**数字证书内容**
包括了加密后服务器的公钥、权威机构的信息、服务器域名，还有经过CA私钥签名之后的证书内容（经过先通过Hash函数计算得到证书数字摘要，然后用权威机构私钥加密数字摘要得到数字签名)，签名计算方法以及证书对应的域名。

**验证证书安全性过程**

数字签名是权威机构私钥对各种信息加密后形成的签名。

1. 当客户端收到这个证书之后，使用本地配置的权威机构的公钥对证书进行解密得到服务端的公钥和证书的数字签名，数字签名经过CA公钥解密得到证书信息摘要。
2. 然后证书签名的方法计算一下当前证书的信息摘 要，与收到的信息摘要作对比，如果一样，表示证书一定是服务器下发的，没有被中间人篡改过。因为中间人虽然有权威机构的公钥，能够解析证书内容并篡改，但是篡改完成之后中间人需要将证书重新加密，但是中间人没有权威机构的私钥，无法加密，强行加密只会导致客户端无法解密，如果中间人强行乱修改证书，就会导致证书内容和证书签名不匹配。

**那第三方攻击者能否让自己的证书显示出来的信息也是服务端呢？**（伪装服务端一样的配置）显然这个是不行的，因为当第三方攻击者去CA那边寻求认证的时候CA会要求其提供例如域名的whois信息、域名管理邮箱等证明你是服务端域名的拥有者，而第三方攻击者是无法提供这些信息所以他就是无法骗CA他拥有属于服务端的域名。





### 为什么https不完全替代http 进行大规模推广呢

加密通讯消耗的更多成本（cpu，内存，）

ca证书不是免费的









## 常见的http码

- 200 OK 客户端请求成功。
- 301 Moved Permanently 请求永久重定向。
- 302 Moved Temporarily 请求临时重定向。
- 304 Not Modified 文件未修改，可以直接使用缓存的文件。
- 400 Bad Request 由于客户端请求有语法错误，不能被服务器所理解。（字段传错）
- 401 Unauthorized 请求未经授权，无法访问。
- 403 Forbidden 服务器收到请求，但是拒绝提供服务。服务器通常会在响应正文中给出不提供服务的原因。
- 404 Not Found 请求的资源不存在，比如输入了错误的URL。
- 500 Internal Server Error 服务器发生不可预期的错误，导致无法完成客户端的请求。
- 503 Service Unavailable 服务器当前不能够处理客户端的请求，在一段时间之后，服务器可能会恢复正常。